<main class="content" id="bodyPreencherAtividade">
  <div id="atividade-aluno">
    <h1 id="atividadeTitulo" class="titulo mt-2">Atividade</h1>
    <form>
      <div id="questoes-container"></div>
      <button type="button" id="respostaAtividadeForm" class="submit-btn">Enviar Respostas</button>
      <div id="mensagem" class="msg-erro" style="display: none;">Por favor, selecione uma resposta para cada pergunta!
      </div>
    </form>
  </div>
  <div class="controle d-none">
    <input type="text" name="" id="agenteId">
    <input type="text" name="" id="idAtividade">
    <input type="text" name="" id="idMateria">
  </div>
</main>
<script>
  $(document).ready(function () {
    $("#respostaAtividadeForm").off().on("click", function () {
      let todasRespondidas = true;
      let respostas = [];

      $("#questoes-container > div").each(function () {
        const questaoId = $(this).data("questao-id");
        const inputSelecionado = $(this).find("input[type=radio]:checked");

        if (!inputSelecionado.length) {
          todasRespondidas = false;
          return false;
        }

        respostas.push({
          questaoId: questaoId,
          alternativaId: parseInt(inputSelecionado.val())
        });
      });

      if (!todasRespondidas) {
        Swal.fire({
          title: 'Por favor, responda todas as questões antes de enviar.',
          icon: 'warning',
          timer: 3000,
          showConfirmButton: false
        });;
        return;
      }

      const confirmar = confirm("Você tem certeza de que deseja enviar suas respostas?");
      if (!confirmar) return;

      const atividadeId = $("#atividade-aluno").data("atividade-id");

      const objetoResposta = {
        agenteId: parseInt($("#agenteId").val()),
        atividadeId: parseInt($("#idAtividade").val()),
        materiaId: parseInt($("#idMateria").val()),
        respostas: respostas
      };

      console.log(objetoResposta);
      enviarRespostaAtividade(objetoResposta)
    });
  });
  async function enviarRespostaAtividade(parametro) {
    try {
      let dados = await executarRequisicao(`atividade/responderAtividade`, parametro, "POST");
      console.log(dados);
      $("#main").load(`./Atividades/index.html`);
      executarScriptsEspecificos('Atividades')
    } catch (ex) {
      Swal({
        title: `Erro ao tentar enviar resposta atividade, por favor tente novamente ${ex}`,
        icon: 'error',
        timer: 3000,
        showConfirmButton: false
      });
    }
  }
</script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>